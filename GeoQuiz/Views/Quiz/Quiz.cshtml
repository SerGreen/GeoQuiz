@model GeoQuiz.Models.QuestionViewModel

@{
    ViewBag.Title = "Quiz";
}

<script>
    var bar;

    $(document).ready(function () {
        bar = new ProgressBar.Line('#progressbar', {
            strokeWidth: 4,
            easing: 'easeInOut',
            duration: 400,
            color: '#009688',
            trailColor: '#ccc',
            trailWidth: 1,
            svgStyle: { width: '100%', height: '100%' }
        });

        bar.set((@Model.Index - 1) / @Model.TotalQuestionsCount);
        bar.animate(@Model.Index / @Model.TotalQuestionsCount);  // Number from 0.0 to 1.0
    });
</script>

<div class="col-xs-offset-1 col-xs-10 well">
    <div class="row vdivide text-center">
        <div class="col-sm-2">
            Question <span id="current-question-index">@Model.Index</span> / @Model.TotalQuestionsCount
            <div id="progressbar" style="width:100%; height:8px"></div>
        </div>
        <div class="col-sm-2">Correct: <span id="correct-answers">@Model.CorrectAnswers</span></div>
        <div class="col-sm-2">Wrong: <span id="wrong-answers">@Model.WrongAnswers</span></div>
    </div>
</div>

<div id="question-container" class="col-xs-offset-1 col-xs-10 well">
    @Html.Partial("PartialFlagByCountry", Model)
</div>
<script>
    // AJAX submit answer function, it returns partial view with new question HTML
    function submitAnswerAjax(questionIndex, answer) {
        var data = {
            questionIndex: questionIndex,
            answer: answer
        };

        $.ajax({
            type: 'POST',
            data: data,
            url: '@Url.Action("Quiz", "Quiz")',
            success: function (result) {
                // Display new question
                $("#question-container").html(result);

                // jQuery can't find anything if result is not inside <div>
                result = '<div>' + result + '</div>';

                // Update progress bar and counters
                var current = $('#questionIndex', result).text();
                var correct = $('#correctAnswers', result).text();
                var wrong = $('#wrongAnswers', result).text();

                bar.animate(current / @Model.TotalQuestionsCount);
                $('#current-question-index').text(current);
                $('#correct-answers').text(correct);
                $('#wrong-answers').text(wrong);

                // If there was mistake, div with id="mistake" is generated
                if ($('#mistake', result).length) {
                    // Display snackbar
                    var options = {
                        content: $('#mistake', result).text(),
                        timeout: 5000
                    }
                    $.snackbar(options);
                }
            }
        });
    }
</script>